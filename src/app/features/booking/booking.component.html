<div class="booking-page">
  <div class="container">
    @if (error() && !hotel()) {
      <div class="alert alert--error">
        <span>‚ö†Ô∏è</span>
        <span>{{ error() }}</span>
      </div>
      <a routerLink="/hotels" class="btn btn--primary">Back to Hotels</a>
    }

    @if (hotel() && !success()) {
      <div class="booking-container">
        <div class="booking-content">
          <div class="booking-header">
            <h1 class="booking-header__title">Complete Your Booking</h1>
            <p class="booking-header__subtitle">
              You're just one step away from your perfect stay
            </p>
          </div>

          <div class="hotel-summary">
            <img
              [src]="hotel()!.images[0]"
              [alt]="hotel()!.name"
              class="hotel-summary__image"
              (error)="onImageError($event)"
              loading="lazy"
            />
            <div class="hotel-summary__details">
              <h2 class="hotel-summary__name">{{ hotel()!.name }}</h2>
              <p class="hotel-summary__location">üìç {{ hotel()!.location }}</p>
              <div class="hotel-summary__rating">
                <span class="stars">‚≠ê {{ hotel()!.starRating }}</span>
                @if (hotel()!.averageRating) {
                  <span class="rating">{{ hotel()!.averageRating }}/5</span>
                }
              </div>
              <p class="hotel-summary__price">
                ${{ hotel()!.pricePerNight }} <span>per night</span>
              </p>
            </div>
          </div>

          <form [formGroup]="bookingForm" (ngSubmit)="onSubmit()" class="booking-form">
            <h3 class="form-section-title">Booking Details</h3>

            <div class="form-row">
              <div class="form-group">
                <label for="checkIn" class="form-label">
                  Check-in Date
                  <span class="required">*</span>
                </label>
                <input
                  type="date"
                  id="checkIn"
                  formControlName="checkIn"
                  [min]="minDate"
                  class="form-input"
                  [class.form-input--error]="bookingForm.get('checkIn')?.invalid && bookingForm.get('checkIn')?.touched"
                />
                @if (bookingForm.get('checkIn')?.invalid && bookingForm.get('checkIn')?.touched) {
                  <span class="form-error">Check-in date is required</span>
                }
              </div>

              <div class="form-group">
                <label for="checkOut" class="form-label">
                  Check-out Date
                  <span class="required">*</span>
                </label>
                <input
                  type="date"
                  id="checkOut"
                  formControlName="checkOut"
                  [min]="minCheckoutDate || minDate"
                  class="form-input"
                  [class.form-input--error]="bookingForm.get('checkOut')?.invalid && bookingForm.get('checkOut')?.touched"
                />
                @if (bookingForm.get('checkOut')?.invalid && bookingForm.get('checkOut')?.touched) {
                  <span class="form-error">Check-out date is required</span>
                }
              </div>
            </div>

            <div class="form-group">
              <label for="guests" class="form-label">
                Number of Guests
                <span class="required">*</span>
              </label>
              <input
                type="number"
                id="guests"
                formControlName="guests"
                min="1"
                max="10"
                class="form-input"
                [class.form-input--error]="bookingForm.get('guests')?.invalid && bookingForm.get('guests')?.touched"
              />
              @if (bookingForm.get('guests')?.invalid && bookingForm.get('guests')?.touched) {
                <span class="form-error">Please enter a valid number of guests (1-10)</span>
              }
            </div>

            <div class="form-group">
              <label for="specialRequests" class="form-label">
                Special Requests (Optional)
              </label>
              <textarea
                id="specialRequests"
                formControlName="specialRequests"
                rows="4"
                placeholder="Any special requirements or requests?"
                class="form-textarea"
              ></textarea>
            </div>

            @if (error()) {
              <div class="alert alert--error">
                <span>‚ö†Ô∏è</span>
                <span>{{ error() }}</span>
              </div>
            }

            <div class="form-actions">
              <a routerLink="/hotels" class="btn btn--secondary">Cancel</a>
              <button
                type="submit"
                class="btn btn--primary"
                [disabled]="loading() || bookingForm.invalid"
              >
                @if (loading()) {
                  <span>Processing...</span>
                } @else {
                  <span>Confirm Booking</span>
                }
              </button>
            </div>
          </form>
        </div>

        <div class="booking-sidebar">
          <div class="price-summary">
            <h3 class="price-summary__title">Price Summary</h3>

            @if (calculateNights() > 0) {
              <div class="price-summary__row">
                <span>${{ hotel()!.pricePerNight }} √ó {{ calculateNights() }} nights</span>
                <span>${{ hotel()!.pricePerNight * calculateNights() }}</span>
              </div>

              <div class="price-summary__divider"></div>

              <div class="price-summary__total">
                <span>Total</span>
                <span>${{ calculateTotalPrice() }}</span>
              </div>
            } @else {
              <p class="price-summary__note">
                Select your dates to see the total price
              </p>
            }
          </div>

          <div class="booking-info">
            <h4 class="booking-info__title">Good to know</h4>
            <ul class="booking-info__list">
              <li>‚úì Free cancellation up to 24 hours before check-in</li>
              <li>‚úì No payment needed today</li>
              <li>‚úì Confirmation is immediate</li>
            </ul>
          </div>
        </div>
      </div>
    }

    @if (success()) {
      <div class="success-container">
        <div class="success-card">
          <div class="success-icon">‚úì</div>
          <h1 class="success-title">Booking Confirmed!</h1>
          <p class="success-message">
            Your booking has been successfully confirmed.
          </p>

          <div class="confirmation-details">
            <div class="confirmation-row">
              <span class="label">Confirmation Number:</span>
              <span class="value">{{ confirmationNumber() }}</span>
            </div>
            <div class="confirmation-row">
              <span class="label">Hotel:</span>
              <span class="value">{{ hotel()!.name }}</span>
            </div>
            <div class="confirmation-row">
              <span class="label">Check-in:</span>
              <span class="value">{{ bookingForm.value.checkIn }}</span>
            </div>
            <div class="confirmation-row">
              <span class="label">Check-out:</span>
              <span class="value">{{ bookingForm.value.checkOut }}</span>
            </div>
            <div class="confirmation-row">
              <span class="label">Guests:</span>
              <span class="value">{{ bookingForm.value.guests }}</span>
            </div>
            <div class="confirmation-row total">
              <span class="label">Total Amount:</span>
              <span class="value">${{ calculateTotalPrice() }}</span>
            </div>
          </div>

          <p class="success-note">
            A confirmation email has been sent to your email address.
          </p>

          <div class="success-actions">
            <button (click)="goToDashboard()" class="btn btn--primary">
              View My Bookings
            </button>
            <a routerLink="/hotels" class="btn btn--secondary">
              Browse More Hotels
            </a>
          </div>
        </div>
      </div>
    }
  </div>
</div>
